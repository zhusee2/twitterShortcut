
<!DOCTYPE html>
<head>
<script>
safari.application.addEventListener("beforeSearch", beforeSearchHandler, true);

function beforeSearchHandler(event) {
  var usernameMatch = event.query.match(/^@(\w+)/),
      hashtagMatch = event.query.match(/^\#(\w+)/),
      detectUsername = safari.extension.settings.detectUsername,
      detectHashtag = safari.extension.settings.detectHashtag;

  if(detectUsername && usernameMatch) {
    event.target.url = 'http://twitter.com/' + usernameMatch[1];
    event.preventDefault();
  }
  
  if(detectHashtag && hashtagMatch) {
    event.target.url = 'http://twitter.com/search?q=%23' + hashtagMatch[1] + '&src=hash';
    event.preventDefault();
  }

}
</script>
